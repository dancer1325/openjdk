JEP 519: Compact Object Headers
======================================================================

| Owner | Roman Kennke | 
| Type | Feature | 
| Scope | Implementation | 
| Status | Closed / Delivered | 
| Release | 25 | 
| Component | hotspot / runtime | 
| Discussion | hotspot dash dev at openjdk dot org | 
| Effort | S | 
| Duration | XS | 
| Relates to | JEP 450: Compact Object Headers (Experimental)](450) | 
| Reviewed by | Coleen Phillimore, Stefan Karlsson, Vladimir Kozlov | 
| Endorsed by | Vladimir Kozlov | 
| Created | 2025/04/15 14:01 | 
| Updated | 2025/08/24 18:03 | 
| Issue | 8354672](https://bugs.openjdk.org/browse/JDK-8354672) | 

## Summary

Change compact object headers from an experimental feature to a product feature.

## Non-Goals

It is not a goal to make compact object headers be the default object-header layout.

## Motivation

Compact object headers were introduced as an alternative object-header layout byJEP 450](https://openjdk.org/jeps/450)in JDK 24. Features of this size are best introduced carefully and gradually, so we introduced it as an experimental feature.

Since JDK 24, compact object headers have proven their stability and performance.

They have been tested at Oracle by running the full JDK test suite. They have also been tested at Amazon by hundreds of services in production, most of them using backports of the feature to JDK 21 and JDK 17.

Various experiments demonstrate that enabling compact object headers improves performance:

- 
In one setting, the SPECjbb2015 benchmark uses22% less heap space and 8% less CPU time](https://github.com/rkennke/talks/blob/master/Lilliput-FOSDEM-2025.pdf).

- 
In another setting, the number of garbage collections done by SPECjbb2015 isreduced by 15%](https://bugs.openjdk.org/browse/JDK-8350457?focusedId=14766358&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-14766358), with both the G1 and Parallel collectors.

- 
A highly parallel JSON parser benchmarkruns in 10% less time](https://www.reddit.com/r/scala/comments/1jptiv3/xxusecompactobjectheaders_is_your_new_turbo/?rdt=40432).

It is time to change compact object headers from an experimental feature to a product feature.

## Description

Compact object headers are enabled in JDK 24 via the command-line options

```
$ java -XX:+UnlockExperimentalVMOptions -XX:+UseCompactObjectHeaders ...
```

The first option,`-XX:+UnlockExperimentalVMOptions`, will no longer be needed once they are a product feature.

## Testing

Compact object headers were subjected to massive testing as part ofJEP 450](https://openjdk.org/jeps/450#Testing), in addition to the testing mentionedabove](#Motivation). No further testing is required.

Some tests currently supply the`-XX:+UnlockExperimentalVMOptions`command-line option when enabling compact object headers. This will no longer be needed, so we will adjust these tests accordingly.

## Risks and Assumptions

As discussed inJEP 450](https://openjdk.org/jeps/450#Risks-and-Assumptions), future features may require additional object-header bits. We have already reserved four bits forProject Valhalla](https://openjdk.org/projects/valhalla/). If a need for even more bits arises then we can shrink compressed class pointers and identity hash codes even further, using techniques we have already prototyped inProject Lilliput](https://wiki.openjdk.org/display/lilliput).