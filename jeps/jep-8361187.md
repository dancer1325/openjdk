JEP draft: Compact Object Headers by Default
======================================================================

| Author | rkennke | 
| Owner | Roman Kennke | 
| Type | Feature | 
| Scope | JDK | 
| Status | Draft | 
| Component | hotspot / runtime | 
| Discussion | hotspot dash runtime dash dev | 
| Effort | XS | 
| Duration | XS | 
| Created | 2025/07/01 13:36 | 
| Updated | 2025/08/24 18:03 | 
| Issue | 8361187](https://bugs.openjdk.org/browse/JDK-8361187) | 

## Summary

Make compact object headers the default object header layout, and deprecate the old 12-byte object header layout, with the intention to remove the old layout in a future release.

## Non-Goals

It is not a goal to completely remove/obsolete the old 12-byte object header layout at this time.

## Motivation

Compact object headers were introduced as an alternative object-header layout byJEP 450](https://openjdk.org/jeps/450)in JDK 24, and turned into a full product feature byJEP 519](https://openjdk.org/jeps/519)in JDK 25. Features of this size are best introduced carefully and gradually, so we have not turned it on by default, yet.

Since JDK 24, compact object headers have proven their stability and performance.

They have been tested at Oracle by running the full JDK test suite. They have also been tested at Amazon by hundreds of services in production, most of them using backports of the feature to JDK 21 and JDK 17.

Various experiments demonstrate that enabling compact object headers improves performance:

- In one setting, the SPECjbb2015 benchmark uses22% less heap space and 8% less CPU time](https://github.com/rkennke/talks/blob/master/Lilliput-FOSDEM-2025.pdf).
- In another setting, the number of garbage collections done by SPECjbb2015 isreduced by 15%](https://bugs.openjdk.org/browse/JDK-8350457?focusedId=14766358&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-14766358), with both the G1 and Parallel collectors.
- A highly parallel JSON parser benchmarkruns in 10% less time](https://www.reddit.com/r/scala/comments/1jptiv3/xxusecompactobjectheaders_is_your_new_turbo/?rdt=40432).

It is time to make compact object headers the default mode of operation and deprecate the old object header layout.

## Description

Compact object headers are enabled in JDK 25 via the command-line options

```
$ java -XX:+UseCompactObjectHeaders ...
```

That option,`-XX:+UseCompactObjectHeaders`, will no longer be needed once they are the default. Instead, if, for any reason, the feature needs to be turned off, it can be done by running with:

```
$ java -XX:-UseCompactObjectHeaders ...
```

## Testing

Compact object headers were subjected to massive testing as part ofJEP 450](https://openjdk.org/jeps/450#Testing)andJEP 519](https://openjdk.org/jeps/519#Testing). Another full set of correctness and performance testing is run before intergration of this JEP.

## Risks and Assumptions

As discussed inJEP 450](https://openjdk.org/jeps/450#Risks-and-Assumptions), future features may require additional object-header bits. We have already reserved four bits forProject Valhalla](https://openjdk.org/projects/valhalla/). If a need for even more bits arises then we can shrink compressed class pointers and identity hash codes even further, using techniques we have already prototyped inProject Lilliput](https://wiki.openjdk.org/display/lilliput).